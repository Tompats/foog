---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import TripsPageContent from "../../../components/TripsPageContent.astro";
import { createCollectionPageJsonLd } from "../../../utils/seo";
import { getTripListingData, getPastTripTotalPages } from "../../../utils/tripPagination";

export async function getStaticPaths() {
  const totalPages = getPastTripTotalPages();
  const paths = [];
  for (let page = 2; page <= totalPages; page += 1) {
    paths.push({ params: { page: String(page) } });
  }
  return paths;
}

const { page } = Astro.params;
const pageNumber = Number(page);

if (!Number.isInteger(pageNumber) || pageNumber < 1) {
  throw new Error("Invalid page number");
}

const { upcomingTrips, pastTrips, pagination } = getTripListingData(pageNumber);

const pageTitle = `Εξορμήσεις · Σελίδα ${pagination.currentPage}`;
const pageDescription = `Δες τις εξορμήσεις του Φ.Ο.Ο.Γ. - σελίδα ${pagination.currentPage} της αρχειοθήκης προηγούμενων διαδρομών.`;

const tripsStructuredData = createCollectionPageJsonLd(
  `Χάρτης εξορμήσεων Φ.Ο.Ο.Γ. · Σελίδα ${pagination.currentPage}`,
  Astro.url.href
);
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  structuredData={[tripsStructuredData]}
>
  <TripsPageContent
    upcomingTrips={upcomingTrips}
    pastTrips={pastTrips}
    pagination={pagination}
  />
</BaseLayout>
