---
import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";
import TripCard from "../components/TripCard.astro";
import SectionHeader from "../components/SectionHeader.astro";
import { trips } from "../data/trips";
import { siteMetadata, organizationId, getSiteBaseUrl } from "../data/site";
import { withBase } from "../utils/url";
import foogVoras from "../assets/images/foog-voras-profitis-hlias.jpg";
import heroBorovets from "../assets/images/foog-borovets-hiking-2025.jpg";
import heroBorovetsTwo from "../assets/images/foog-borovets-hiking-2025-2.jpg";
import heroGrammos from "../assets/images/foog-aetomilitsa-grammos-1.jpeg";
import heroBorevetsSki from "../assets/images/foog-borovets.jpg";
import heroSkiJuniorLesson from "../assets/images/foog-ski-junior.jpg";
import { isTripUpcoming, isTripPast } from "../types";

const upcomingTrips = [...trips]
  .filter((trip) => isTripUpcoming(trip))
  .sort(
    (a, b) => new Date(a.startDate).getTime() - new Date(b.startDate).getTime()
  )
  .slice(0, 4);

const latestReports = [...trips]
  .filter((trip) => isTripPast(trip))
  .sort(
    (a, b) => new Date(b.startDate).getTime() - new Date(a.startDate).getTime()
  )
  .slice(0, 3);

const features = [
  {
    title: "Εκπαίδευση σκι & χιονοσανίδας",
    body: "Εβδομαδιαία τμήματα σε Καϊμάκτσαλαν, 3-5 Πηγάδια και Σέλι με εξοπλισμό του Ομίλου και πιστοποιημένους προπονητές για κάθε επίπεδο.",
    iconClass: "fa-solid fa-person-skiing",
  },
  {
    title: "Εξορμήσεις για κάθε εποχή",
    body: "Μονοήμερες και πολυήμερες πεζοπορίες από το Πάικο έως τον Όλυμπο, διαδρομές trail και αναρρίχησης που χωρίζονται ανά εμπειρία για να απολαμβάνει όλη η παρέα.",
    iconClass: "fa-solid fa-route",
  },
  {
    title: "Φροντίδα των μονοπατιών μας",
    body: "Καθαρισμοί, σηματοδότηση, δεντροφυτεύσεις και η υποστήριξη του καταφυγίου Αγίας Παρασκευής κρατούν ζωντανή την σχέση μας με το βουνό και την κοινότητα.",
    iconClass: "fa-solid fa-seedling",
  },
  {
    title: "Κοινότητα 250+ μελών",
    body: "Συνδρομή 10€ ανά έτος, οικογένειες, αρχάριοι και προχωρημένοι μοιράζονται μετακινήσεις, στιγμές και συνεργασίες με συλλόγους σε Ελλάδα και Βαλκάνια.",
    iconClass: "fa-solid fa-users",
  },
];

const heroStats = [
  {
    value: "30+",
    valueClass: "text-3xl text-brand-pine",
    label: "Εξορμησεις/ετος",
  },
  {
    value: "250+",
    valueClass: "text-3xl text-brand-terracotta",
    label: "Μελη",
  },
  {
    value: "∞",
    valueClass: "text-5xl text-brand-moss",
    label: "Ιστοριες",
  },
];

const heroGallery = [
  {
    image: heroBorovets,
    alt: "Πεζοπορία του Φ.Ο.Ο.Γ. στο Μπόροβιτς",
    caption: "Μπόροβιτς · Ορειβασία 2025",
  },
  {
    image: heroBorovetsTwo,
    alt: "Ομάδα βαδίζει προς την κορυφή",
    caption: "Πεζοπορία · Ρίλα",
  },
  {
    image: heroGrammos,
    alt: "Ανάβαση του Φ.Ο.Ο.Γ. στον Γράμμο",
    caption: "Ορειβασία · Γράμμος",
  },
  {
    image: heroBorevetsSki,
    alt: "Εκδρομή του Φ.Ο.Ο.Γ. στο Μπόροβιτς",
    caption: "Μπόροβιτς · 2ήμερο Χιονοδρομίας",
  },
  {
    image: heroSkiJuniorLesson,
    alt: "Προπόνηση μικρής ομάδας στα 3-5 πηγάδια",
    caption: "Προπόνηση Σκι - 3/5 Πηγάδια",
  },
];

const homepageStructuredData = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "@id": `${getSiteBaseUrl()}#website`,
  url: getSiteBaseUrl(),
  name: siteMetadata.name,
  alternateName: siteMetadata.shortName,
  inLanguage: siteMetadata.locale,
  description: siteMetadata.description,
  publisher: {
    "@id": organizationId,
  },
};
---

<BaseLayout structuredData={[homepageStructuredData]}>
  <section class="section-padding pt-10" data-reveal>
    <div
      class="glass-panel px-8 py-14 lg:px-12 lg:py-20 overflow-hidden relative"
    >
      <div
        class="absolute inset-y-0 right-0 w-1/2 opacity-30 pointer-events-none hidden lg:block"
      >
        <svg
          viewBox="0 0 400 400"
          class="w-full h-full"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M0 360L120 210L200 290L320 150L400 220V400H0Z"
            fill="url(#grad)"></path>
          <defs>
            <linearGradient id="grad" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#A7C957" stop-opacity="0.6"></stop>
              <stop offset="100%" stop-color="#E26D5A" stop-opacity="0.4"
              ></stop>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div
        class="grid gap-8 lg:grid-cols-[minmax(0,1fr),700px] lg:items-center"
      >
        <div>
          <p class="text-sm uppercase tracking-[0.3em] text-brand-pine">
            Φ.Ο.Ο.Γ · Φυσιολατρικός Ορειβατικός Όμιλος Γιαννιτσών
          </p>
          <h1
            class="mt-6 text-4xl sm:text-5xl lg:text-6xl font-semibold text-brand-rocky heading-font max-w-3xl"
          >
            Τα όρη με καλούν...και πρέπει να πάω.
          </h1>
          <p class="mt-6 text-lg text-brand-mist max-w-2xl">
            Από πέντε φίλους στα Γιαννιτσά το 1973 φτάσαμε σε κοινότητα 252
            ενεργών μελών που μοιράζονται στιγμές στο βουνό. Μαθήματα σκι,
            πεζοπορίες, ποδηλασία και δεντροφυτεύσεις δίνουν χώρο σε κάθε
            αρχάριο να αγαπήσει το βουνό.
          </p>
          <div class="mt-10 flex flex-wrap gap-4">
            <a
              href={withBase("/trips")}
              class="btn-ripple inline-flex items-center justify-center rounded-full bg-brand-terracotta px-8 py-3 text-base font-semibold text-brand-cloud shadow-lg shadow-brand-terracotta/40 transition hover:scale-105 hover:text-brand-cloud"
            >
              Δες τις επόμενες εξορμήσεις
            </a>
            <a
              href={withBase("/join")}
              class="btn-ripple inline-flex items-center justify-center rounded-full border border-brand-pine/30 px-8 py-3 text-base font-semibold text-brand-pine hover:border-brand-terracotta hover:text-brand-terracotta transition"
            >
              Γίνε μέλος
            </a>
          </div>
        </div>
        <figure class="relative mt-4 lg:mt-0 lg:w-[700px]" data-tilt="6">
          <div
            class="relative rounded-[32px] overflow-hidden shadow-2xl shadow-brand-river/40 border border-brand-river/30 h-80 lg:h-[440px] bg-brand-river/10"
          >
            <Image
              src={foogVoras}
              alt="Σημαία του Φ.Ο.Ο.Γ. σε χιονισμένη κορυφή"
              class="h-full w-full object-cover"
              loading="lazy"
              sizes="(min-width: 1024px) 700px, 100vw"
            />
            <div
              class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-brand-river/60"
            >
            </div>
            <figcaption
              class="absolute bottom-4 left-4 text-brand-cloud text-sm font-semibold"
            >
              Κορυφή Βόρας – Προφήτης Ηλίας
            </figcaption>
          </div>
        </figure>
      </div>
      <div class="mt-8 grid gap-4 sm:grid-cols-3 text-center">
        {heroStats.map((stat) => (
          <div class="rounded-2xl bg-brand-cloud/70 py-6 px-4 shadow-sm flex flex-col items-center justify-center min-h-[140px]">
            <p class={`font-bold heading-font ${stat.valueClass}`}>{stat.value}</p>
            <p class="mt-2 text-xs uppercase tracking-[0.3em] text-brand-mist">
              {stat.label}
            </p>
          </div>
        ))}
      </div>
      <div class="mt-12 space-y-4">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <div>
            <p class="text-xs uppercase tracking-[0.3em] text-brand-mist">
              Φωτογραφικά στιγμιότυπα
            </p>
            <h2 class="text-xl font-semibold text-brand-rocky heading-font">
              Τελευταίες λήψεις από την παρέα
            </h2>
          </div>
          <div class="flex gap-2">
            <button
              type="button"
              class="inline-flex h-12 w-12 items-center justify-center rounded-full border border-brand-river/30 text-brand-mist hover:text-brand-terracotta hover:border-brand-terracotta transition"
              aria-label="Προηγούμενη φωτογραφία"
              data-gallery-prev
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15 6 9 12l6 6"></path>
              </svg>
            </button>
            <button
              type="button"
              class="inline-flex h-12 w-12 items-center justify-center rounded-full border border-brand-river/30 text-brand-mist hover:text-brand-terracotta hover:border-brand-terracotta transition"
              aria-label="Επόμενη φωτογραφία"
              data-gallery-next
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m9 6 6 6-6 6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="relative">
          <div
            class="flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory scrollbar-hide"
            data-gallery-track
            role="listbox"
            aria-label="Γκαλερί φωτογραφιών του Φ.Ο.Ο.Γ."
          >
            {
              heroGallery.map((photo, index) => (
                <figure
                  class="w-[75%] sm:w-[320px] lg:w-[360px] snap-start shrink-0"
                  data-gallery-card
                  data-selected={index === 0 ? "true" : "false"}
                  aria-selected={index === 0 ? "true" : "false"}
                  role="option"
                  tabindex={index === 0 ? "0" : "-1"}
                >
                  <div class="carousel-card relative h-56 sm:h-64 rounded-3xl overflow-hidden">
                    <Image
                      src={photo.image}
                      alt={photo.alt}
                      class="h-full w-full object-cover"
                      loading="lazy"
                    />
                    <div class="absolute inset-0 bg-gradient-to-t from-brand-river/70 via-transparent to-transparent" />
                    <figcaption
                      class="carousel-caption absolute bottom-4 left-4 text-brand-cloud text-sm font-semibold"
                      data-gallery-caption
                      aria-hidden={index === 0 ? "false" : "true"}
                    >
                      {photo.caption}
                    </figcaption>
                  </div>
                </figure>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section-padding" id="upcoming-trips" data-reveal>
    <SectionHeader
      eyebrow="Σχεδιασμός"
      title="Επερχόμενες περιπέτειες"
      subtitle="Μικρές ομάδες, άρτια οργάνωση και υποστήριξη προπονητών"
    />
    {
      upcomingTrips.length > 0 ? (
        <div class="grid gap-6 lg:grid-cols-2">
          {upcomingTrips.map((trip) => (
            <TripCard trip={trip} />
          ))}
        </div>
      ) : (
        <div class="glass-panel p-6 text-brand-mist text-center">
          <p class="text-lg font-semibold text-brand-cloud">
            Δεν υπάρχουν προγραμματισμένες εξορμήσεις αυτή τη στιγμή.
          </p>
          <p class="mt-2">
            Δες τις προηγούμενες διαδρομές μας ή επικοινώνησε για να ενημερωθείς
            για τα επόμενα σχέδια.
          </p>
        </div>
      )
    }
    <div class="mt-10 text-center">
      <a
        href={withBase("/trips")}
        class="inline-flex items-center gap-2 rounded-full border border-brand-cloud/50 px-6 py-3 text-sm font-semibold text-brand-cloud hover:border-brand-terracotta hover:text-brand-terracotta"
      >
        Όλες οι εξορμήσεις
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          class="h-4 w-4"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M5 12h14m-6-6 6 6-6 6"></path>
        </svg>
      </a>
    </div>
  </section>

  <section class="section-padding" data-reveal>
    <div class="grid gap-10 lg:grid-cols-[1.1fr,0.9fr] items-center">
      <div>
        <SectionHeader
          eyebrow="Ταυτότητα"
          title="Ρίζες στα Γιαννιτσά"
          subtitle="Από το 1973 φέρνουμε τους ανθρώπους κοντά στη φύση με δράσεις αλληλεγγύης και μάθησης."
        />
        <div class="glass-panel p-8 space-y-4 text-brand-mist bg-brand-river/5">
          <p>
            Ο Φ.Ο.Ο.Γ. ξεκίνησε από πέντε φυσιολάτρες που το 1973 ονειρεύτηκαν
            έναν όμιλο με ελεύθερη πρόσβαση στο βουνό και το 1977 απέκτησε
            καταστατικό με χιονοδρομία, ορειβασία, ποδηλασία βουνού και
            αναρρίχηση. Η οικονομική κρίση του 2010 περιόρισε τις δράσεις μας,
            όμως η είσοδος νεότερων εθελοντών ξανάφερε τον παλμό και σήμερα 252
            μέλη υποστηρίζουν ένα πρόγραμμα που μεγαλώνει με υπευθυνότητα.
          </p>
          <p>
            Μαθήματα σκι για μικρούς και μεγάλους, πεζοπορίες στο Πάικο, τα
            Τζουμέρκα, τα Άγραφα, τα Ζαγόρια και μέχρι τη Βάλια Κάλντα, τα
            δασικά χωριά της Ξάνθης και της Καβάλας και τον Όλυμπο, ποδηλατικές
            διαδρομές 240 χιλιομέτρων, νυχτερινές πορείες στην Πανσέληνο του
            Κυνηγού και ιστορικά μονοπάτια της 19ης Οκτωβρίου συνδέονται με
            καθαρισμούς, δεντροφυτεύσεις και συνεργασίες με το δασαρχείο, τον
            Δήμο Πέλλας και άλλους φορείς και συλλόγους, με τη συμμετοχή και
            κατοίκων της περιοχής ώστε η φροντίδα της φύσης να μοιράζεται πέρα
            από τα μέλη.
          </p>
          <a
            href={withBase("/history")}
            class="inline-flex items-center gap-2 text-brand-pine font-semibold"
          >
            Δες όλη την ιστορία
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M5 12h14m-6-6 6 6-6 6"></path>
            </svg>
          </a>
        </div>
      </div>
      <div class="grid gap-6">
        {
          features.map((feature) => (
            <div class="glass-panel p-6 flex items-start gap-4 transition hover:-translate-y-1 bg-brand-cloud/95">
              <div class="h-12 w-12 rounded-full bg-brand-cloud flex items-center justify-center text-brand-pine shadow-inner shrink-0">
                <i class={`${feature.iconClass} text-2xl`} aria-hidden="true" />
              </div>
              <div>
                <h2 class="text-xl font-semibold text-brand-rocky heading-font">
                  {feature.title}
                </h2>
                <p class="text-brand-mist text-sm mt-2">{feature.body}</p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <style>
    [data-gallery-card] {
      transition: opacity 200ms ease, transform 200ms ease;
    }

    [data-gallery-card][data-selected="false"] {
      opacity: 0.55;
    }

    [data-gallery-card] .carousel-card {
      transition: transform 250ms ease, box-shadow 250ms ease;
    }

    [data-gallery-card][data-selected="false"] .carousel-card {
      transform: scale(0.97);
    }

    [data-gallery-card][data-selected="true"] .carousel-card {
      box-shadow: 0 10px 26px rgba(16, 44, 51, 0.25);
    }

    .carousel-caption {
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 250ms ease, transform 250ms ease;
    }

    [data-gallery-card][data-selected="true"] .carousel-caption {
      opacity: 1;
      transform: translateY(0);
    }
  </style>

  <script>
    (() => {
      const track = document.querySelector<HTMLElement>("[data-gallery-track]");
      if (!track) return;

      const prevButton = document.querySelector<HTMLElement>("[data-gallery-prev]");
      const nextButton = document.querySelector<HTMLElement>("[data-gallery-next]");
      const cards = Array.from(
        track.querySelectorAll<HTMLElement>("[data-gallery-card]")
      );
      if (!cards.length) return;

      let activeIndex = Math.max(
        0,
        cards.findIndex((card) => card.dataset.selected === "true")
      );
      const AUTOPLAY_DELAY = 3500;
      let autoplayTimer: number | undefined;
      let scrollFrame: number | undefined;
      let suppressScrollSync = false;
      let suppressScrollTimeout: number | undefined;

      const getMaxScrollLeft = () =>
        Math.max(0, track.scrollWidth - track.clientWidth);
      const isAtStart = () => track.scrollLeft <= 4;
      const isAtEnd = () => getMaxScrollLeft() - track.scrollLeft <= 4;

      const updateSelection = () => {
        cards.forEach((card, index) => {
          const isSelected = index === activeIndex;
          card.dataset.selected = isSelected ? "true" : "false";
          card.setAttribute("aria-selected", String(isSelected));
          card.setAttribute("tabindex", isSelected ? "0" : "-1");
          const caption = card.querySelector("[data-gallery-caption]");
          if (caption) {
            caption.setAttribute("aria-hidden", String(!isSelected));
          }
        });
      };

      const temporarilyDisableScrollSync = (duration = 450) => {
        suppressScrollSync = true;
        window.clearTimeout(suppressScrollTimeout);
        suppressScrollTimeout = window.setTimeout(() => {
          suppressScrollSync = false;
        }, duration);
      };

      const scrollToActive = (behavior: ScrollBehavior = "smooth") => {
        const activeCard = cards[activeIndex];
        if (!activeCard) return;
        const maxScrollLeft = getMaxScrollLeft();
        const idealLeft =
          activeCard.offsetLeft - (track.clientWidth - activeCard.clientWidth) / 2;
        const nextScrollLeft = Math.min(
          maxScrollLeft,
          Math.max(0, idealLeft)
        );
        const distance = Math.abs(nextScrollLeft - track.scrollLeft);
        const duration =
          behavior === "smooth"
            ? Math.min(1000, Math.max(450, distance * 0.8))
            : 200;
        temporarilyDisableScrollSync(duration);
        track.scrollTo({ left: nextScrollLeft, behavior });
      };

      type CarouselTransitionOptions = {
        scrollBehavior?: ScrollBehavior;
      };

      const goToIndex = (
        nextIndex: number,
        options: CarouselTransitionOptions = {}
      ) => {
        if (!cards.length) return;
        const { scrollBehavior = "smooth" } = options;
        const total = cards.length;
        activeIndex = ((nextIndex % total) + total) % total;
        updateSelection();
        scrollToActive(scrollBehavior);
      };

      const showNext = () => goToIndex(activeIndex + 1);
      const showPrev = () => goToIndex(activeIndex - 1);

      const stopAutoplay = () => {
        if (!autoplayTimer) return;
        window.clearInterval(autoplayTimer);
        autoplayTimer = undefined;
      };

      const startAutoplay = () => {
        if (autoplayTimer || cards.length <= 1) return;
        autoplayTimer = window.setInterval(() => {
          showNext();
        }, AUTOPLAY_DELAY);
      };

      const restartAutoplay = () => {
        stopAutoplay();
        startAutoplay();
      };

      prevButton?.addEventListener("click", () => {
        showPrev();
        restartAutoplay();
      });

      nextButton?.addEventListener("click", () => {
        showNext();
        restartAutoplay();
      });

      cards.forEach((card, index) => {
        card.addEventListener("click", () => {
          if (index === activeIndex) return;
          goToIndex(index);
          restartAutoplay();
        });

        card.addEventListener("focus", () => {
          if (document.activeElement !== card) return;
          activeIndex = index;
          updateSelection();
        });

        card.addEventListener("keydown", (event: KeyboardEvent) => {
          if (event.key === "ArrowRight") {
            event.preventDefault();
            showNext();
            restartAutoplay();
          } else if (event.key === "ArrowLeft") {
            event.preventDefault();
            showPrev();
            restartAutoplay();
          }
        });
      });

      const attachAutoplayListeners = (element: HTMLElement | null) => {
        if (!element) return;
        element.addEventListener("pointerenter", stopAutoplay);
        element.addEventListener("pointerleave", startAutoplay);
        element.addEventListener("touchstart", stopAutoplay, { passive: true });
        element.addEventListener("touchend", startAutoplay);
      };

      attachAutoplayListeners(track);
      attachAutoplayListeners(prevButton);
      attachAutoplayListeners(nextButton);

      track.addEventListener(
        "wheel",
        () => {
          stopAutoplay();
        },
        { passive: true }
      );

      const syncSelectionToScroll = () => {
        if (isAtStart()) {
          if (activeIndex !== 0) {
            activeIndex = 0;
            updateSelection();
          }
          return;
        }

        if (isAtEnd()) {
          const lastIndex = cards.length - 1;
          if (activeIndex !== lastIndex) {
            activeIndex = lastIndex;
            updateSelection();
          }
          return;
        }

        const center = track.scrollLeft + track.clientWidth / 2;
        let closestIndex = activeIndex;
        let smallestDistance = Number.POSITIVE_INFINITY;

        cards.forEach((card, index) => {
          const cardCenter = card.offsetLeft + card.clientWidth / 2;
          const distance = Math.abs(cardCenter - center);
          if (distance < smallestDistance) {
            smallestDistance = distance;
            closestIndex = index;
          }
        });

        if (closestIndex !== activeIndex) {
          activeIndex = closestIndex;
          updateSelection();
        }
      };

      track.addEventListener("scroll", () => {
        if (suppressScrollSync) return;
        if (scrollFrame !== undefined) {
          window.cancelAnimationFrame(scrollFrame);
        }
        scrollFrame = window.requestAnimationFrame(syncSelectionToScroll);
      });

      updateSelection();
      startAutoplay();
    })();
  </script>
</BaseLayout>
